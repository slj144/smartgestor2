
<div id="containerFormUpdate">
  <div *ngIf="!loading">  
    <form [formGroup]="adjustmentForm" class="form" (submit)="onSubmit()">
      <div class="row">
        <div class="col-12 form-group">
          <h6>Detalhes do Produto</h6>

          <div class="row">
            <div class="col-12 form-group">
              <label>Código do Produto</label>
              <div class="container-field">
                <input type="text" formControlName="productCode" class="form-control {{ formControls.productCode.errors ? 'required' : '' }}" (keydown.enter)="onSearchProduct(productCodeField.value)" #productCodeField />
                <button type="button" [disabled]="(productCodeField.value == '')" (click)="onSearchProduct(productCodeField.value)"><icon name="arrow-forward-outline" pack="eva"></icon></button>
              </div>

              <div class="container-product" *ngIf="productData">
                <table>
                  <tr>
                    <td>
                      <div class="container-image">
                        <img [src]="(productData.thumbnail ?? 'assets/images/Stock/Products/image-placeholder.jpg')" />
                      </div>
                    </td>
                    <td>
                      <span><span class="label">Nome:</span> <span class="value">{{ productData.name }}</span></span>
                      <span><span class="label">Código:</span> <span class="value">{{ productData.code }}</span></span>
                      <span><span class="label">Quantidade: </span> <span class="value">{{ productData.quantity }}</span></span>                        
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 form-group">
          <h6>Ajuste do Produto</h6>

          <!-- <fieldset [disabled]="!productData"> -->
            <div class="row">
              <div class="col-4 form-group">
                <label>Operação</label>

                <select formControlName="operation" class="form-control {{ formControls.operation.errors ? 'required' : '' }}">
                  <option value="INPUT">Entrada</option>
                  <option value="OUTPUT" *ngIf="productData?.quantity > 0">Saída</option>
                </select>
              </div>

              <div class="col-8 form-group">
                <label>Quantidade</label>
                <input type="text" formControlName="quantity" class="form-control  {{ formControls.quantity.errors ? 'required' : '' }}" (input)="onApplyNumberMask($event, formControls.quantity)"/>
              </div>                
            </div>

            <div class="row">
              <div class="col-12 form-group">
                <label>Tipo</label>

                <div class="manager-type clearfix">
                  <select formControlName="type" class="form-control {{ formControls.type.errors ? 'required' : '' }}">
                    <option *ngFor="let item of adjustmentTypes" value="{{ item.code }}">{{ item.code + ' - ' + item.name }}</option>
                  </select>
                  <button type="button" (click)="onOpenLayer('adjustmentTypes')"><icon name="list-outline" pack="eva"></icon></button>
                </div>              
              </div>
            </div>
            
            <div class="row">
              <div class="col-12 form-group">
                <label>Nota de Ajuste</label>
                <textarea formControlName="note" class="form-control {{ formControls.note.errors ? 'required' : '' }}"></textarea>
              </div>
            </div>
          <!-- </fieldset> -->
        </div>
      </div>
      
      <button class="btn" [disabled]="!(adjustmentForm.valid && productData)">Confimar</button>
    </form>
  </div>

  <div *ngIf="loading"
    [nbSpinner]="loading"
    [nbSpinnerStatus]="'success'"
    [nbSpinnerSize]="'large'"
    class="loader">
  </div>

  <stock-adjustment-register-layer (callback)="onLayerResponse($event)"></stock-adjustment-register-layer>
</div>
